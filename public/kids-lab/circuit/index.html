<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Kids Lab ‚Äì Build a Circuit</title>
  <link rel="stylesheet" href="../style.css"/>
  <style>
    .board{background:#0f172a;border:1px dashed #334155;border-radius:14px;padding:16px;min-height:320px}
    .tray{display:flex;gap:10px;margin:12px 0}
    .piece{background:#111827;border:1px solid #374151;padding:10px 16px;border-radius:12px;cursor:grab}
    .drop{min-height:70px;border:2px dashed #475569;border-radius:12px;padding:8px;display:flex;gap:8px;align-items:center}
    .lamp{width:36px;height:36px;border-radius:50%;background:#111;border:2px solid #333;box-shadow:0 0 0 0 rgba(255,255,100,0)}
    .lamp.on{background:radial-gradient(circle at 50% 40%, #fff7aa, #ffd84d); box-shadow:0 0 24px 6px rgba(255,216,77,.6)}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">‚ö° Build a Circuit</div>
      <a href="../" class="btn">‚Üê Back</a>
    </div>

    <div class="card">
      <p>Drag a <strong>battery</strong>, <strong>switch</strong> and <strong>bulb</strong> into the circuit area, then click the switch to power it.</p>
      <div class="tray">
        <div class="piece" draggable="true" data-type="battery">üîã Battery</div>
        <div class="piece" draggable="true" data-type="switch">üîÄ Switch</div>
        <div class="piece" draggable="true" data-type="bulb">üí° Bulb</div>
      </div>
      <div class="board">
        <div>Drop parts here:</div>
        <div id="circuit" class="drop"></div>
        <div style="margin-top:12px;display:flex;align-items:center;gap:10px">
          <button class="btn-primary" id="toggle">Toggle Switch</button>
          <div id="lamp" class="lamp" title="Bulb"></div>
        </div>
      </div>
    </div>
  </div>
  <script type="module">
    import { sfx } from "../js/common.js";
    const circuit = document.getElementById('circuit');
    const lamp = document.getElementById('lamp');
    let hasBattery=false, hasSwitch=false, hasBulb=false, switchOn=false;

    document.querySelectorAll('.piece').forEach(el=>{
      el.addEventListener('dragstart', e=>{
        e.dataTransfer.setData('type', el.dataset.type);
      });
    });
    circuit.addEventListener('dragover', e=>e.preventDefault());
    circuit.addEventListener('drop', e=>{
      e.preventDefault();
      const type = e.dataTransfer.getData('type');
      if(!type) return;
      const node = document.createElement('span');
      node.className='pill';
      node.textContent = type;
      circuit.appendChild(node);
      sfx.click.play();
      if(type==='battery') hasBattery=true;
      if(type==='switch') hasSwitch=true;
      if(type==='bulb') hasBulb=true;
      updateLamp();
    });
    document.getElementById('toggle').onclick=()=>{
      if(!hasSwitch){ return; }
      switchOn=!switchOn;
      sfx.click.play();
      updateLamp();
    };
    function updateLamp(){
      const on = hasBattery && hasSwitch && hasBulb && switchOn;
      lamp.classList.toggle('on', on);
      if(on) sfx.success.play();
    }
  </script>
</body>
</html>
