<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Kids Lab – Power the House</title>
  <link rel="stylesheet" href="../style.css"/>
  <style>
    .row{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #1f2937;padding:8px 0}
    .meter{height:16px;background:#111827;border-radius:8px;overflow:hidden;border:1px solid #374151}
    .bar{height:100%;background:linear-gradient(90deg,#22c55e,#f59e0b,#ef4444);width:0%}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">⚡ Power the House</div>
      <a href="../" class="btn">← Back</a>
    </div>
    <div class="card">
      <p>Keep total power under <strong>2000 W</strong>. Switch things on/off wisely!</p>
      <div id="list"></div>
      <div style="margin-top:14px">
        <div class="meter"><div id="bar" class="bar"></div></div>
        <div id="total" class="small"></div>
      </div>
    </div>
  </div>
  <script type="module">
    import { sfx } from "../js/common.js";
    const devices = [
      {name:'Kettle', w:1800, on:false},
      {name:'TV', w:120, on:false},
      {name:'Lamp', w:12, on:false},
      {name:'Heater', w:900, on:false},
      {name:'Laptop', w:60, on:false},
      {name:'Fridge', w:150, on:true},
    ];
    const limit = 2000;
    const list = document.getElementById('list');
    const totalEl = document.getElementById('total');
    const bar = document.getElementById('bar');

    function render(){
      list.innerHTML='';
      let total=0;
      devices.forEach((d,idx)=>{
        if(d.on) total+=d.w;
        const row = document.createElement('div');
        row.className='row';
        row.innerHTML = \`
          <strong>\${d.name}</strong>
          <div>
            <span class="small" style="margin-right:8px">\${d.w} W</span>
            <button class="btn-primary" data-i="\${idx}">\${d.on?'Turn off':'Turn on'}</button>
          </div>\`;
        list.appendChild(row);
      });
      const pct = Math.min(100, Math.round(total/limit*100));
      bar.style.width = pct + '%';
      totalEl.textContent = \`Total: \${total} W / Limit: \${limit} W\`;
      totalEl.className = 'small ' + (total>limit?'error':'success');
      list.querySelectorAll('button').forEach(btn=>{
        btn.onclick = () => {
          const i = +btn.dataset.i;
          devices[i].on = !devices[i].on;
          sfx.click.play();
          render();
        }
      });
    }
    render();
  </script>
</body>
</html>
